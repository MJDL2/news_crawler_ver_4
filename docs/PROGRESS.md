# 네이버 뉴스 크롤러 v4 - 진행 상황

## 프로젝트 개요
- **목적**: 네이버 뉴스 검색 엔진을 통한 체계적인 뉴스 수집 및 본문 추출
- **핵심 기능**: 검색어×언론사×날짜 매트릭스 방식의 체계적 수집
- **현재 버전**: 4.2.2

## 진행 현황 (2025-06-03)

### ✅ 완료된 작업

#### 최적화 및 버그 수정 (v4.2.2)
- [x] 병합 로직 개선
  - content_limit 기본값을 0(전체)으로 변경
  - balanced 추출 방식 정식 지원 (even_distribution 별칭)
  - 병합시 content_limit이 0일 때 전체 데이터 포함
- [x] UI/UX 개선  
  - "본문 추출 개수" → "병합시 최종 추출 개수"로 명확히 표시
  - 날짜별 수집시 "일별 최대 수집 개수" 별도 입력 추가
  - 예상 수집량 계산 로직 수정
- [x] 파라미터 분리
  - content_limit: 병합시 전체 제한
  - daily_limit: 일별 수집 제한
  - 혼용 문제 해결

#### 1. 프로젝트 구조 리팩토링 (v4.0.0)
- [x] 모듈화된 아키텍처 구조 도입
- [x] 순환 참조 문제 해결
- [x] 통합 문서화 시스템 구축
- [x] 싱글톤 설정 관리 시스템

#### 2. 대화형 인터페이스 개선 (v4.1.0)
- [x] 복수 검색어 지원 (쉼표로 구분)
- [x] 언론사 선택 기능 추가
  - 전체 언론사
  - 주요 언론사 프리셋
  - 직접 입력 옵션
- [x] 수집과 추출 통합 (URL+본문 동시 수집)
- [x] 불필요한 옵션 제거
- [x] 질문 단계 간소화 (8단계 → 5단계)

#### 3. 기능 테스트
- [x] 명령줄 인자 방식 정상 작동 확인
- [x] "원전" 키워드 테스트 (2025-05-15 ~ 2025-05-28)
  - 16개 URL 수집, 10개 본문 추출
  - 소요 시간: 21.59초
  - 오류 없이 안정적 작동

#### 4. 프로젝트 정리 (v4.1.1)
- [x] 루트 디렉토리 정리 완료
  - 개발/분석 파일 10개를 `dev/analysis/` 디렉토리로 이동
  - 프로덕션 코드와 개발 코드 분리
- [x] 문서 업데이트
  - README.md 프로젝트 구조 현행화
  - PROGRESS.md 진행 상황 반영

#### 5. Windows 콘솔 인코딩 문제 해결 (v4.1.2)
- [x] main.py에 Windows 콘솔 UTF-8 설정 추가
  - chcp 65001 자동 실행
  - PYTHONIOENCODING 환경 변수 설정
  - PYTHONUNBUFFERED 환경 변수 추가
- [x] 대화형 모드와 CLI 간 옵션 매핑 수정
  - interactive.py의 반환 옵션을 CLI 형식으로 변환
  - 지연 시간 기본값 설정 추가

#### 6. **🔥 중요** 네이버 뉴스 URL 형식 업데이트 (v4.2.1) - **2025-05-29**
- [x] **네이버 검색 URL 형식 변경 대응**
  - 기존: `where=news` → 신규: `ssc=tab.news.all`
  - 기존: `ds=20250527` → 신규: `ds=2025.05.27` (점 구분 형식)  
  - 기존: `pd=8` → 신규: `pd=3` (직접입력 모드)
  - `nso` 파라미터 형식 정상화
- [x] **수정된 파일**: `src/models/search_options.py`의 `build_url()` 메서드
- [x] **테스트 결과**:
  - ✅ URL 생성: 신버전 형식으로 정상 생성
  - ✅ 브라우저 확인: 날짜 필터 정상 작동 (`2025.05.29. ~ 2025.05.29.`)
  - ✅ 전체 크롤링 테스트: "원전" 키워드로 24개 URL 수집, 3개 본문 추출 성공
  - ✅ 실행 시간: 약 10초 (개선됨)
- [x] **중요성**: 이 수정 없이는 날짜 필터가 작동하지 않아 부정확한 뉴스 수집됨
- [x] 대화형 모드 입력 블로킹 문제 해결
  - 로깅 완전 비활성화 (대화형 모드)
  - 크롤링 시작 시 사용자 알림 추가
  - run_interactive_v2.bat 및 run_interactive.ps1 제공
- [x] 명령줄 모드 작동 확인 (테스트 성공)

#### 6. 날짜별 수집 기능 수정 (v4.1.3)
- [x] 일별 수집 제한 옵션 로직 수정
  - daily_collect 시 content_limit을 0으로 설정
  - _daily_limit 옵션 추가로 일별 제한 별도 관리
- [x] CLI에서 날짜별 수집 기능 통합
  - DailyCollector 사용 로직 추가
  - 대화형 모드의 _daily_collect 옵션 처리
- [x] 진행 상황 표시 개선
  - URL 수집 및 본문 추출 시 실시간 표시
  - 소요 시간 표시 추가
- [x] DailyCollector 오류 수정
  - StorageConfig.root_dir 대신 news_data_dir 사용
  - extract_from_urls 대신 extract_content 사용
  - 설정 매핑 수정 (정렬, 뉴스 유형)
  - 진행 상황 표시 추가

#### 7. 날짜별 수집 JSON 직렬화 오류 수정 (v4.1.4)
- [x] DailyCollector datetime 직렬화 오류 해결
  - NewsArticle의 asdict() 대신 to_dict() 메서드 사용
  - stats의 start_time, end_time을 ISO 형식 문자열로 변환
  - 날짜별 수집 기능 정상 작동 확인 (70개 URL, 6개 본문)
- [x] Windows 콘솔 특수문자 표시 오류 수정
  - 체크마크(✓)를 [완료]로 변경
  - cp949 인코딩 오류 해결

#### 8. 403 Forbidden 오류 대응 (v4.1.5)
- [x] 네이버 봇 차단 대응 기능 추가
  - 실제 브라우저와 유사한 헤더 구성
  - 세션 초기화 시 네이버 메인/검색 페이지 사전 방문
  - 환경 변수 기반 프록시 지원
  - 403 오류 시 증가된 재시도 대기 시간
- [x] 403 오류 해결 가이드 문서 작성
  - 설정 파일을 통한 지연 시간 조정 방법
  - 프록시/VPN 사용법 안내

#### 9. Python 3.13 호환성 문제 해결 (v4.1.6)
- [x] cookiejar AttributeError 문제 해결
  - 'NoneType' object has no attribute '_now' 오류 수정
  - extractors.py의 쿠키 정책 설정 제거
  - main.py에 Python 3.13 호환성 패치 추가
- [x] PYTHON313_FIX.md 문서 작성
  - 문제 원인 분석 및 해결 방법 정리
  - 대체 해결 방법 제시

#### 10. 설정 관리 및 403 오류 대응 강화 (v4.2.0)
- [x] **통합 설정 파일 시스템 구축**
  - config.json과 crawler_config.json 통합 → unified_config.json
  - CSS 선택자 설정 파일 연동 구현
  - 고급 설정 섹션 추가 (세션 관리, 403 대응, 중복 관리)
- [x] **세션 풀 관리 기능 추가**
  - SessionPool 클래스 구현 (src/utils/session_pool.py)
  - 403 오류 발생 시 세션 자동 차단 및 재생성
  - 라운드 로빈 방식의 세션 분배
  - 프록시 로테이션 지원 기반 마련
- [x] **콘텐츠 추출 개선**
  - 설정 파일에서 CSS 선택자 동적 로드
  - 본문 길이 검증 로직 추가 (최소/최대 길이)
  - 불필요한 요소 제거 설정 연동
- [x] **Daily Collector 병합 기능 구현**
  - _merge_daily_contents 메서드 완성
  - 3가지 추출 모드 지원: sequential, even_distribution, recent_first
  - 날짜별 균등 분배 알고리즘 구현
  - 임시 파일 자동 정리 기능
- [x] **테스트 코드 작성**
  - test_improvements.py 스크립트 추가
  - 4개 주요 기능 테스트 (모두 성공)

#### 11. CLI 시스템 버그 발견 및 수정 (v4.2.1 → v4.2.4 - 2025-12-03)
- [x] **CLI help 시스템 무한 대기 버그 수정 완료**
  - `python main.py --help` 실행 시 응답 없이 무한 대기하던 문제 해결
  - 원인: CLI 초기화 시 NewsCrawler, NaverNewsDailyCollector 등의 객체 생성 과정에서 블로킹
  - 해결책: 
    - main.py에서 --help 옵션 사전 체크하여 Windows 콘솔 설정 건너뛰기
    - CLI 클래스에서 --help 옵션 시 객체 초기화 최소화
  - 임시 해결책으로 show_help.bat 파일 제공
- [x] **문서 구조 정합성 문제 해결 완료**
  - README.md의 프로젝트 구조를 실제 구조에 맞게 수정
  - 존재하지 않던 디렉토리/파일 제거: `dev/`, `docs/issues/`, `src/utils/monitoring.py`
  - 실제 존재하는 파일들 추가: 모든 .bat/.ps1 파일, 루트 디렉토리의 문서 파일들
  - 알려진 문제 섹션 업데이트

#### 12. URL 수집 제한 로직 버그 수정 (v4.2.2 - 2025-05-29)
- [x] **extractors.py의 max_urls 제한 체크 버그 수정**
  - max_urls 체크를 새 URL 추가 직후로 이동
  - 기존: 중복 체크 루프 중간에서 부정확한 위치에서 체크
  - 수정: 새로운 URL이 collected_urls에 추가된 직후 정확한 제한 체크
- [x] **페이지별 수집 상황 로깅 개선**
  - 실시간 진행 상황 표시 추가
  - 페이지별 신규 URL 개수와 총 수집 개수 표시
- [x] **일별 15개 제한 설정이 8개씩만 수집되는 문제 해결**
  - 사용자 보고: 일별 15개 설정 시 실제로는 8개씩만 수집
  - 원인: max_urls 제한 체크 로직의 위치 오류
  - 해결: 정확한 개수만큼 수집되도록 로직 수정

#### 13. 날짜별 수집 파일 병합 버그 수정 (v4.2.3 - 2025-05-29)
- [x] **날짜별 수집 시 파일 병합이 실행되지 않는 문제 수정**
  - 문제: data/temp_daily/에 날짜별 파일만 생성되고 병합 파일이 생성되지 않음
  - 원인: cli.py에서 content_limit=0으로 전달하여 병합 조건(content_limit > 0)을 만족하지 못함
  - 해결: content_limit에 사용자 입력값(args.content_limit) 전달하도록 수정
- [x] **병합 파일 생성 확인**
  - 병합 파일명: `merged_contents_[검색어]_[시작날짜]_[종료날짜]_[시간].json`
  - 저장 위치: data/news_data/
  - 3가지 병합 모드 지원: sequential, even_distribution, recent_first

### 🔄 현재 상태: 문서 구조 정합성 개선 완료 (v4.2.4)

프로젝트가 안정화 단계에 진입했습니다. 주요 버그들이 해결되었고, 문서와 실제 코드 간의 정합성도 확보되었습니다.

#### 다음 우선순위 작업
1. **실시간 진행 상황 표시 개선** (진행 중)
   - tqdm 프로그레스 바 통합
   - 수집/추출 진행률 실시간 표시
   - 남은 시간 예측 기능

2. **대화형 인터페이스 완성** (부분 완료)
   - 복수 검색어 처리 로직 구현 필요
   - 언론사별 개별 수집 기능 구현 필요

#### 현재 진행 가능한 작업
- [x] Windows 콘솔 인코딩 문제 해결 ✓
- [x] 실시간 진행 상황 표시 개선 ✓ (기본 구현)
- [x] 날짜별 수집 기능 수정 ✓

### 📋 다음 진행 예정

> **주요 참조**: [개발 로드맵](../DEVELOPMENT_ROADMAP.md) - 장기 개발 계획 및 우선순위

#### 단기 계획 (1-2주)
1. **대화형 인터페이스 완성**
   - 옵션 전달 로직 수정
   - 매트릭스 수집 방식 구현

2. **수집 전략 최적화**
   - 검색어×언론사×날짜 조합별 수집
   - 중복 제거 로직 강화

3. **에러 처리 강화**
   - 네트워크 오류 재시도
   - 부분 실패 시 복구 로직

#### 중기 계획 (1개월)
1. **성능 최적화**
   - 병렬 처리 도입
   - 메모리 사용량 최적화

2. **데이터 관리**
   - SQLite 데이터베이스 옵션
   - 수집 이력 관리

3. **분석 기능**
   - 기본 통계 대시보드
   - 언론사별 보도 경향 분석

### 🐛 알려진 문제점

1. ~~**Windows 환경**~~ ✓ 해결됨 (v4.1.2, v4.1.4)
   - ~~콘솔 인코딩으로 인한 한글 깨짐 (데이터는 정상)~~
   - ~~해결 방안: `chcp 65001` 사용~~
   - ~~특수문자(✓) 표시 오류~~ ✓ 해결됨 (v4.1.4)

2. ~~**날짜별 수집 기능**~~ ✓ 해결됨 (v4.1.4)
   - ~~datetime JSON 직렬화 오류~~
   - ~~"Object of type datetime is not JSON serializable" 오류~~

3. **대화형 모드**
   - ~~크롤러로 옵션 전달 시 형식 불일치~~ ✓ 해결됨 (v4.1.2)
   - Windows 환경에서 대화형 입력 시 버퍼링 문제 발생 가능
   - 해결 방안: 명령줄 인자 방식 사용 권장

4. **네이버 변경사항**
   - 페이지네이션 → 스크롤 방식 변경됨
   - 일부 옵션 무의미해짐

5. ~~**403 Forbidden 오류**~~ ✓ 대응 완료 (v4.1.5)
   - ~~네이버의 봇 차단으로 인한 403 오류 발생~~
   - ~~해결 방안: 헤더 개선, 프록시 지원, 지연 시간 증가~~
   - 403_ERROR_GUIDE.md 참조

6. ~~**Python 3.13 호환성**~~ ✓ 해결됨 (v4.1.6)
   - ~~cookiejar의 '_now' 속성 설정 오류~~
   - ~~해결 방안: 쿠키 정책 설정 제거 및 호환성 패치 적용~~
   - PYTHON313_FIX.md 참조

### 📊 프로젝트 통계

- **총 코드 라인**: 약 3,000줄
- **모듈 수**: 15개
- **테스트 커버리지**: 개발 중
- **문서화 완성도**: 80%

### 💡 개선 아이디어

1. **사용자 경험**
   - 웹 기반 GUI 개발
   - 수집 템플릿 저장/불러오기

2. **기능 확장**
   - 다른 포털 지원 (Daum, Google News)
   - AI 기반 요약 기능

3. **자동화**
   - 스케줄링 기능
   - 알림/리포트 자동 생성

---

*최종 업데이트: 2025-12-03 (문서 구조 정합성 개선)*